{"version":3,"file":"page-CkA4F6cG.js","sources":["../../src/pages/checkout/page.tsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Header } from '../../components/base/Header';\nimport { Footer } from '../../components/base/Footer';\nimport { useCart } from '../../contexts/CartContext';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabase = createClient(\n  import.meta.env.VITE_PUBLIC_SUPABASE_URL,\n  import.meta.env.VITE_PUBLIC_SUPABASE_ANON_KEY\n);\n\nexport default function CheckoutPage() {\n  const navigate = useNavigate();\n  const { items, total, clearCart } = useCart();\n  const { user } = useAuth();\n  const [step, setStep] = useState<'shipping' | 'payment'>('shipping');\n  const [loading, setLoading] = useState(false);\n  const [errorMessage, setErrorMessage] = useState('');\n  const [saveCard, setSaveCard] = useState(false);\n\n  // Dados de envio\n  const [shippingData, setShippingData] = useState({\n    full_name: '',\n    email: '',\n    phone: '',\n    street: '',\n    city: '',\n    postal_code: '',\n    country: 'PT',\n  });\n\n  const [savedAddresses, setSavedAddresses] = useState<any[]>([]);\n  const [selectedAddressId, setSelectedAddressId] = useState<string>('');\n  const [showAddressSelector, setShowAddressSelector] = useState(false);\n\n  // NOVO: CONFIGURA√á√ïES DE ENVIO POR PA√çS DO DATABASE\n  const [countryShippingRates, setCountryShippingRates] = useState<any[]>([]);\n  const [shippingCost, setShippingCost] = useState(0);\n  const [freeShippingThreshold, setFreeShippingThreshold] = useState(0);\n  \n  // Configura√ß√µes de IVA\n  const [vatSettings, setVatSettings] = useState<any>(null);\n  const [vatAmount, setVatAmount] = useState(0);\n  const [vatEnabled, setVatEnabled] = useState(false);\n  const [vatIncluded, setVatIncluded] = useState(true);\n  const [vatRate, setVatRate] = useState(0);\n\n  // Carregar endere√ßos salvos do utilizador\n  useEffect(() => {\n    if (user) {\n      loadSavedAddresses();\n    }\n  }, [user]);\n\n  // CARREGAR CONFIGURA√á√ïES DE ENVIO POR PA√çS DO DATABASE\n  useEffect(() => {\n    loadCountryShippingRates();\n  }, []);\n\n  // RECALCULAR QUANDO O PA√çS OU TOTAL MUDAR\n  useEffect(() => {\n    if (countryShippingRates.length > 0) {\n      updateShippingCostForCountry(shippingData.country);\n    }\n  }, [shippingData.country, total, countryShippingRates]);\n\n  // CARREGAR CONFIGURA√á√ïES DE IVA\n  useEffect(() => {\n    loadVatSettings();\n  }, [shippingData.country, total, shippingCost]);\n\n  // NOVA FUN√á√ÉO: Carregar custos de envio por pa√≠s do database\n  const loadCountryShippingRates = async () => {\n    try {\n      console.log('üîÑ A carregar custos de envio por pa√≠s do database...');\n      \n      const { data, error } = await supabase\n        .from('site_settings')\n        .select('value')\n        .eq('key', 'country_shipping_rates')\n        .maybeSingle();\n\n      if (error) {\n        console.error('‚ùå Erro ao carregar custos de envio:', error);\n        return;\n      }\n\n      if (data && data.value && Array.isArray(data.value)) {\n        console.log('‚úÖ Custos de envio carregados:', data.value.length, 'pa√≠ses');\n        setCountryShippingRates(data.value);\n        \n        // Aplicar configura√ß√£o do pa√≠s atual\n        updateShippingCostForCountry(shippingData.country, data.value);\n      } else {\n        console.log('‚ö†Ô∏è Nenhuma configura√ß√£o de envio encontrada no database');\n      }\n    } catch (error) {\n      console.error('‚ùå Erro ao carregar configura√ß√µes de envio:', error);\n    }\n  };\n\n  // NOVA FUN√á√ÉO: Atualizar custo de envio baseado no pa√≠s selecionado\n  const updateShippingCostForCountry = (countryCode: string, rates?: any[]) => {\n    const ratesToUse = rates || countryShippingRates;\n    \n    if (ratesToUse.length === 0) {\n      console.log('‚ö†Ô∏è Sem configura√ß√µes de envio dispon√≠veis');\n      return;\n    }\n\n    // Encontrar configura√ß√£o para o pa√≠s selecionado\n    const countryConfig = ratesToUse.find(\n      (c: any) => c.code === countryCode && c.enabled\n    );\n\n    if (countryConfig) {\n      console.log(`‚úÖ Configura√ß√£o encontrada para ${countryConfig.name} (${countryCode}):`);\n      console.log(`   - Custo de envio: ‚Ç¨${countryConfig.cost}`);\n      console.log(`   - Envio gr√°tis acima de: ‚Ç¨${countryConfig.free_threshold}`);\n      \n      setShippingCost(countryConfig.cost);\n      setFreeShippingThreshold(countryConfig.free_threshold);\n    } else {\n      console.log(`‚ö†Ô∏è Pa√≠s ${countryCode} n√£o encontrado ou desativado. A usar valores padr√£o.`);\n      setShippingCost(7.99);\n      setFreeShippingThreshold(50);\n    }\n  };\n\n  const loadVatSettings = async () => {\n    try {\n      const { data, error } = await supabase\n        .from('site_settings')\n        .select('*')\n        .eq('key', 'tax_shipping_settings')\n        .maybeSingle();\n\n      if (data && data.value) {\n        const settings = data.value;\n        setVatSettings(settings);\n\n        // Configura√ß√µes de IVA\n        if (settings.taxEnabled !== undefined) {\n          setVatEnabled(settings.taxEnabled);\n          \n          const isIncluded = settings.taxCalculation === 'included';\n          setVatIncluded(isIncluded);\n\n          if (settings.taxEnabled) {\n            // Encontrar taxa de IVA para o pa√≠s selecionado\n            const countryTax = settings.taxRates?.find((t: any) => \n              t.country_code === shippingData.country && t.enabled\n            );\n\n            const rate = countryTax ? countryTax.rate : 23; // Taxa padr√£o Portugal: 23%\n            setVatRate(rate);\n\n            // Calcular IVA sobre produtos\n            if (isIncluded) {\n              // IVA J√Å INCLU√çDO: extrair o IVA do subtotal\n              const productVat = (total * rate) / (100 + rate);\n              setVatAmount(productVat);\n            } else {\n              // IVA ADICIONADO: calcular IVA sobre o subtotal\n              const productVat = total * (rate / 100);\n              setVatAmount(productVat);\n            }\n          } else {\n            setVatAmount(0);\n            setVatRate(0);\n          }\n        }\n      }\n    } catch (error) {\n      console.error('Erro ao carregar configura√ß√µes de IVA:', error);\n    }\n  };\n\n  const loadSavedAddresses = async () => {\n    if (!user) return;\n\n    try {\n      const { data, error } = await supabase\n        .from('addresses')\n        .select('*')\n        .eq('user_id', user.id)\n        .order('is_default', { ascending: false });\n\n      if (data && !error) {\n        setSavedAddresses(data);\n        \n        const defaultAddress = data.find(addr => addr.is_default);\n        if (defaultAddress) {\n          setShippingData({\n            full_name: defaultAddress.full_name || user.full_name || '',\n            email: user.email || '',\n            phone: defaultAddress.phone || user.phone || '',\n            street: defaultAddress.street || '',\n            city: defaultAddress.city || '',\n            postal_code: defaultAddress.postal_code || '',\n            country: defaultAddress.country || 'PT',\n          });\n          setSelectedAddressId(defaultAddress.id);\n        }\n      }\n    } catch (error) {\n      console.error('Erro ao carregar endere√ßos:', error);\n    }\n  };\n\n  const handleAddressSelect = (address: any) => {\n    setShippingData({\n      full_name: address.full_name || user?.full_name || '',\n      email: user?.email || '',\n      phone: address.phone || user?.phone || '',\n      street: address.street || '',\n      city: address.city || '',\n      postal_code: address.postal_code || '',\n      country: address.country || 'PT',\n    });\n    setSelectedAddressId(address.id);\n    setShowAddressSelector(false);\n  };\n\n  // Carregar dados do utilizador se estiver logado\n  useEffect(() => {\n    if (user && savedAddresses.length === 0) {\n      setShippingData(prev => ({\n        ...prev,\n        full_name: user.full_name || '',\n        email: user.email || '',\n        phone: user.phone || '',\n      }));\n    }\n  }, [user, savedAddresses]);\n\n  // Redirecionar se carrinho vazio\n  useEffect(() => {\n    if (items.length === 0) {\n      navigate('/cart');\n    }\n  }, [items, navigate]);\n\n  const isFormValid = () => {\n    if (!shippingData.full_name || !shippingData.email || !shippingData.phone || \n        !shippingData.street || !shippingData.city || !shippingData.postal_code) {\n      return false;\n    }\n\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(shippingData.email)) {\n      return false;\n    }\n\n    return true;\n  };\n\n  const handleContinueToPayment = () => {\n    setErrorMessage('');\n    \n    if (!isFormValid()) {\n      setErrorMessage('Por favor, preencha todos os campos obrigat√≥rios');\n      return;\n    }\n\n    setStep('payment');\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const handlePayment = async () => {\n    if (!isFormValid()) {\n      setErrorMessage('Por favor, preencha todos os campos obrigat√≥rios');\n      return;\n    }\n\n    setLoading(true);\n    setErrorMessage('');\n\n    try {\n      console.log('üîÑ Iniciando processo de pagamento...');\n\n      const token = await supabase.auth.getSession();\n      const authToken = token.data.session?.access_token;\n\n      console.log('üîë Token obtido:', authToken ? 'Sim' : 'N√£o');\n\n      const currentUrl = window.location.origin + __BASE_PATH__;\n      const successUrl = `${currentUrl}/checkout/success?session_id={CHECKOUT_SESSION_ID}`;\n      const cancelUrl = `${currentUrl}/checkout/error`;\n\n      console.log('üîó URLs configuradas:', { successUrl, cancelUrl });\n\n      // ENVIAR CONFIGURA√á√ïES DE ENVIO E PA√çS PARA O EDGE FUNCTION\n      const requestBody = {\n        items: items.map(item => ({\n          id: item.id,\n          name: item.name,\n          price: item.price,\n          quantity: item.quantity,\n          image: item.image,\n          size: item.size,\n          color: item.color,\n        })),\n        shippingAddress: shippingData,\n        shippingCountry: shippingData.country,\n        saveCardInfo: saveCard,\n        successUrl,\n        cancelUrl,\n      };\n\n      console.log('üì¶ Dados a enviar:', {\n        items: requestBody.items.length,\n        email: shippingData.email,\n        country: shippingData.country,\n        total: total.toFixed(2),\n      });\n\n      const headers: any = {\n        'Content-Type': 'application/json',\n        'apikey': import.meta.env.VITE_PUBLIC_SUPABASE_ANON_KEY,\n      };\n\n      if (authToken) {\n        headers['Authorization'] = `Bearer ${authToken}`;\n      }\n\n      console.log('üì° A enviar pedido para Edge Function...');\n\n      const response = await fetch(\n        `${import.meta.env.VITE_PUBLIC_SUPABASE_URL}/functions/v1/create-checkout-session`,\n        {\n          method: 'POST',\n          headers,\n          body: JSON.stringify(requestBody),\n        }\n      );\n\n      console.log('üì• Resposta recebida:', response.status, response.statusText);\n\n      const responseText = await response.text();\n      console.log('üìÑ Resposta (texto):', responseText);\n\n      let data;\n      try {\n        data = JSON.parse(responseText);\n        console.log('‚úÖ Resposta (JSON):', data);\n      } catch (e) {\n        console.error('‚ùå Erro ao fazer parse da resposta:', e);\n        throw new Error('Resposta inv√°lida do servidor');\n      }\n\n      if (!response.ok) {\n        console.error('‚ùå Erro na resposta:', data);\n        throw new Error(data.error || 'Erro ao processar pagamento');\n      }\n\n      if (!data.success) {\n        console.error('‚ùå Pagamento n√£o teve sucesso:', data);\n        throw new Error(data.error || 'Erro ao criar sess√£o de pagamento');\n      }\n\n      if (!data.url) {\n        console.error('‚ùå URL de pagamento n√£o recebida:', data);\n        throw new Error('URL de pagamento n√£o dispon√≠vel');\n      }\n\n      console.log('‚úÖ Sess√£o criada com sucesso!');\n      console.log('üÜî Session ID:', data.sessionId);\n      console.log('üîó URL de pagamento:', data.url);\n      console.log('üí∞ Valor:', data.amount);\n\n      console.log('üöÄ A redirecionar para Stripe...');\n      \n      window.location.href = data.url;\n\n    } catch (err: any) {\n      console.error('‚ùå ERRO CR√çTICO:', err);\n      console.error('‚ùå Mensagem:', err.message);\n      console.error('‚ùå Stack:', err.stack);\n      \n      setErrorMessage(err.message || 'Erro ao processar pagamento. Tente novamente.');\n      setLoading(false);\n    }\n  };\n\n  // üî• C√ÅLCULO CORRETO: Aplicar envio gr√°tis se total >= threshold\n  const actualShippingCost = total >= freeShippingThreshold ? 0 : shippingCost;\n  \n  // C√°lculo do total final\n  let finalTotal = 0;\n  let shippingVat = 0;\n  \n  if (vatEnabled) {\n    if (vatIncluded) {\n      // IVA J√Å INCLU√çDO\n      if (actualShippingCost > 0) {\n        shippingVat = (actualShippingCost * vatRate) / (100 + vatRate);\n      }\n      finalTotal = total + actualShippingCost;\n    } else {\n      // IVA ADICIONADO\n      if (actualShippingCost > 0) {\n        shippingVat = actualShippingCost * (vatRate / 100);\n      }\n      finalTotal = total + vatAmount + actualShippingCost + shippingVat;\n    }\n  } else {\n    finalTotal = total + actualShippingCost;\n  }\n\n  if (items.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col bg-gradient-to-br from-sky-50 via-blue-50 to-indigo-50\">\n      <Header />\n\n      <main className=\"flex-1 pt-24 sm:pt-32 pb-12 sm:pb-20\">\n        <div className=\"max-w-6xl mx-auto px-4 sm:px-6\">\n          {/* Cabe√ßalho */}\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl sm:text-4xl font-bold text-gray-800 mb-4\">Finalizar Compra</h1>\n            \n            {/* Indicador de Passos */}\n            <div className=\"flex items-center gap-4\">\n              <div className={`flex items-center gap-2 ${step === 'shipping' ? 'text-sky-600' : 'text-green-600'}`}>\n                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${\n                  step === 'shipping' ? 'bg-sky-600 text-white' : 'bg-green-600 text-white'\n                }`}>\n                  {step === 'shipping' ? '1' : <i className=\"ri-check-line\"></i>}\n                </div>\n                <span className=\"font-semibold\">Dados de Envio</span>\n              </div>\n              <div className=\"flex-1 h-1 bg-gray-200 rounded\">\n                <div className={`h-full rounded transition-all duration-500 ${\n                  step === 'payment' ? 'bg-sky-600 w-full' : 'bg-gray-200 w-0'\n                }`}></div>\n              </div>\n              <div className={`flex items-center gap-2 ${step === 'payment' ? 'text-sky-600' : 'text-gray-400'}`}>\n                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold ${\n                  step === 'payment' ? 'bg-sky-600 text-white' : 'bg-gray-200'\n                }`}>\n                  2\n                </div>\n                <span className=\"font-semibold\">Pagamento</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Mensagem de Erro Global */}\n          {errorMessage && (\n            <div className=\"mb-6 p-4 bg-red-50 border-l-4 border-red-500 rounded-lg\">\n              <div className=\"flex items-start gap-3\">\n                <i className=\"ri-error-warning-line text-xl text-red-600 mt-0.5\"></i>\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-semibold text-red-700\">{errorMessage}</p>\n                </div>\n                <button \n                  onClick={() => setErrorMessage('')}\n                  className=\"text-red-600 hover:text-red-800 cursor-pointer\"\n                >\n                  <i className=\"ri-close-line text-xl\"></i>\n                </button>\n              </div>\n            </div>\n          )}\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n            {/* Formul√°rio */}\n            <div className=\"lg:col-span-2\">\n              {step === 'shipping' && (\n                <div className=\"bg-white rounded-2xl p-6 sm:p-8 shadow-sm border-2 border-sky-200\">\n                  <h2 className=\"text-2xl font-bold text-gray-800 mb-6\">Dados de Envio</h2>\n                  \n                  {/* Seletor de Endere√ßos Salvos */}\n                  {user && savedAddresses.length > 0 && (\n                    <div className=\"mb-6\">\n                      <div className=\"flex items-center justify-between mb-3\">\n                        <label className=\"block text-sm font-medium text-gray-700\">\n                          Endere√ßos Salvos\n                        </label>\n                        <button\n                          type=\"button\"\n                          onClick={() => setShowAddressSelector(!showAddressSelector)}\n                          className=\"text-sm text-sky-600 hover:text-sky-700 cursor-pointer font-medium\"\n                        >\n                          {showAddressSelector ? 'Ocultar' : 'Escolher endere√ßo'}\n                        </button>\n                      </div>\n                      \n                      {showAddressSelector && (\n                        <div className=\"space-y-2 max-h-60 overflow-y-auto border border-gray-200 rounded-lg p-3 bg-sky-50\">\n                          {savedAddresses.map((address) => (\n                            <button\n                              key={address.id}\n                              type=\"button\"\n                              onClick={() => handleAddressSelect(address)}\n                              className={`w-full text-left p-4 rounded-lg border-2 transition-all cursor-pointer ${\n                                selectedAddressId === address.id\n                                  ? 'border-sky-500 bg-sky-100'\n                                  : 'border-gray-200 bg-white hover:border-sky-300'\n                              }`}\n                            >\n                              <div className=\"flex items-start justify-between\">\n                                <div className=\"flex-1\">\n                                  <p className=\"font-semibold text-gray-800\">{address.full_name}</p>\n                                  <p className=\"text-sm text-gray-600 mt-1\">{address.street}</p>\n                                  <p className=\"text-sm text-gray-600\">\n                                    {address.postal_code} {address.city}, {address.country}\n                                  </p>\n                                  {address.phone && (\n                                    <p className=\"text-sm text-gray-600 mt-1\">\n                                      <i className=\"ri-phone-line mr-1\"></i>\n                                      {address.phone}\n                                    </p>\n                                  )}\n                                </div>\n                                {address.is_default && (\n                                  <span className=\"text-xs bg-sky-500 text-white px-2 py-1 rounded-full\">\n                                    Padr√£o\n                                  </span>\n                                )}\n                              </div>\n                            </button>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n                  )}\n                  \n                  <div className=\"space-y-4\">\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Nome Completo *\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={shippingData.full_name}\n                        onChange={(e) => setShippingData({ ...shippingData, full_name: e.target.value })}\n                        className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all\"\n                        placeholder=\"Seu nome completo\"\n                        required\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Email *\n                        </label>\n                        <input\n                          type=\"email\"\n                          value={shippingData.email}\n                          onChange={(e) => setShippingData({ ...shippingData, email: e.target.value })}\n                          className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all\"\n                          placeholder=\"seu@email.com\"\n                          required\n                        />\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Telefone *\n                        </label>\n                        <input\n                          type=\"tel\"\n                          value={shippingData.phone}\n                          onChange={(e) => setShippingData({ ...shippingData, phone: e.target.value })}\n                          className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all\"\n                          placeholder=\"+351 xxx xxx xxx\"\n                          required\n                        />\n                      </div>\n                    </div>\n\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Morada Completa *\n                      </label>\n                      <input\n                        type=\"text\"\n                        value={shippingData.street}\n                        onChange={(e) => setShippingData({ ...shippingData, street: e.target.value })}\n                        className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all\"\n                        placeholder=\"Rua, n√∫mero, andar\"\n                        required\n                      />\n                    </div>\n\n                    <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Cidade *\n                        </label>\n                        <input\n                          type=\"text\"\n                          value={shippingData.city}\n                          onChange={(e) => setShippingData({ ...shippingData, city: e.target.value })}\n                          className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all\"\n                          required\n                        />\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          C√≥digo Postal *\n                        </label>\n                        <input\n                          type=\"text\"\n                          value={shippingData.postal_code}\n                          onChange={(e) => setShippingData({ ...shippingData, postal_code: e.target.value })}\n                          className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all\"\n                          required\n                        />\n                      </div>\n\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Pa√≠s *\n                        </label>\n                        <select\n                          value={shippingData.country}\n                          onChange={(e) => setShippingData({ ...shippingData, country: e.target.value })}\n                          className=\"w-full px-4 py-3 bg-sky-50 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sky-500 focus:border-transparent cursor-pointer transition-all\"\n                          required\n                        >\n                          <option value=\"PT\">üáµüáπ Portugal</option>\n                          <option value=\"ES\">üá™üá∏ Espanha</option>\n                          <option value=\"FR\">üá´üá∑ Fran√ßa</option>\n                          <option value=\"DE\">üá©üá™ Alemanha</option>\n                          <option value=\"IT\">üáÆüáπ It√°lia</option>\n                          <option value=\"NL\">üá≥üá± Pa√≠ses Baixos</option>\n                          <option value=\"BE\">üáßüá™ B√©lgica</option>\n                          <option value=\"LU\">üá±üá∫ Luxemburgo</option>\n                          <option value=\"AT\">üá¶üáπ √Åustria</option>\n                          <option value=\"GR\">üá¨üá∑ Gr√©cia</option>\n                          <option value=\"IE\">üáÆüá™ Irlanda</option>\n                          <option value=\"DK\">üá©üá∞ Dinamarca</option>\n                          <option value=\"SE\">üá∏üá™ Su√©cia</option>\n                          <option value=\"FI\">üá´üáÆ Finl√¢ndia</option>\n                          <option value=\"PL\">üáµüá± Pol√≥nia</option>\n                          <option value=\"CZ\">üá®üáø Rep√∫blica Checa</option>\n                          <option value=\"HU\">üá≠üá∫ Hungria</option>\n                          <option value=\"RO\">üá∑üá¥ Rom√©nia</option>\n                          <option value=\"BG\">üáßüá¨ Bulg√°ria</option>\n                          <option value=\"HR\">üá≠üá∑ Cro√°cia</option>\n                          <option value=\"SK\">üá∏üá∞ Eslov√°quia</option>\n                          <option value=\"SI\">üá∏üáÆ Eslov√©nia</option>\n                          <option value=\"EE\">üá™üá™ Est√≥nia</option>\n                          <option value=\"LV\">üá±üáª Let√≥nia</option>\n                          <option value=\"LT\">üá±üáπ Litu√¢nia</option>\n                          <option value=\"MT\">üá≤üáπ Malta</option>\n                          <option value=\"CY\">üá®üáæ Chipre</option>\n                        </select>\n                      </div>\n                    </div>\n\n                    <button\n                      onClick={handleContinueToPayment}\n                      disabled={!isFormValid()}\n                      className=\"w-full px-8 py-5 bg-gradient-to-r from-sky-500 to-blue-600 text-white rounded-xl hover:from-sky-600 hover:to-blue-700 transition-all duration-300 text-base font-bold shadow-lg shadow-sky-300/50 whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-sky-400/60 active:scale-95\"\n                    >\n                      <span className=\"flex items-center justify-center gap-3\">\n                        Continuar para Pagamento Seguro\n                        <i className=\"ri-arrow-right-line text-xl\"></i>\n                      </span>\n                    </button>\n                  </div>\n                </div>\n              )}\n\n              {step === 'payment' && (\n                <div className=\"bg-white rounded-2xl p-6 sm:p-8 shadow-sm border-2 border-sky-200\">\n                  <div className=\"flex items-center justify-between mb-6\">\n                    <h2 className=\"text-2xl font-bold text-gray-800\">Pagamento Seguro</h2>\n                    <button\n                      onClick={() => setStep('shipping')}\n                      disabled={loading}\n                      className=\"text-sky-600 hover:text-blue-700 font-medium cursor-pointer hover:underline transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n                    >\n                      <i className=\"ri-arrow-left-line mr-1\"></i>\n                      Voltar\n                    </button>\n                  </div>\n\n                  {/* M√©todos de Pagamento */}\n                  <div className=\"mb-6\">\n                    <h3 className=\"font-semibold text-gray-800 mb-4\">M√©todos de Pagamento Aceites</h3>\n                    <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n                      <div className=\"bg-gradient-to-br from-sky-50 to-blue-100 p-4 rounded-xl border-2 border-sky-300 flex items-center justify-center hover:scale-110 transition-transform duration-200 cursor-pointer hover:shadow-lg\">\n                        <i className=\"ri-bank-card-line text-3xl text-sky-600\"></i>\n                      </div>\n                      <div className=\"bg-gradient-to-br from-sky-50 to-blue-100 p-4 rounded-xl border-2 border-sky-300 flex items-center justify-center hover:scale-110 transition-transform duration-200 cursor-pointer hover:shadow-lg\">\n                        <i className=\"ri-mastercard-line text-3xl text-sky-600\"></i>\n                      </div>\n                      <div className=\"bg-gradient-to-br from-sky-50 to-blue-100 p-4 rounded-xl border-2 border-sky-300 flex items-center justify-center hover:scale-110 transition-transform duration-200 cursor-pointer hover:shadow-lg\">\n                        <i className=\"ri-google-line text-3xl text-sky-600\"></i>\n                      </div>\n                      <div className=\"bg-gradient-to-br from-sky-50 to-blue-100 p-4 rounded-xl border-2 border-sky-300 flex items-center justify-center hover:scale-110 transition-transform duration-200 cursor-pointer hover:shadow-lg\">\n                        <i className=\"ri-apple-line text-3xl text-sky-600\"></i>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Garantias de Seguran√ßa */}\n                  <div className=\"bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border-2 border-green-200 mb-6\">\n                    <div className=\"flex items-start gap-3 mb-4\">\n                      <i className=\"ri-shield-check-line text-3xl text-green-600\"></i>\n                      <div>\n                        <h4 className=\"font-bold text-green-900 mb-2\">Pagamento 100% Seguro</h4>\n                        <ul className=\"text-sm text-green-800 space-y-1\">\n                          <li>‚úì Encripta√ß√£o SSL de n√≠vel banc√°rio</li>\n                          <li>‚úì Conformidade PCI DSS N√≠vel 1</li>\n                          <li>‚úì Autentica√ß√£o 3D Secure</li>\n                          <li>‚úì Processamento seguro pela tecnologia l√≠der mundial</li>\n                        </ul>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Resumo dos Dados */}\n                  <div className=\"bg-sky-50 p-4 rounded-xl mb-6 border-2 border-sky-200\">\n                    <h4 className=\"font-semibold text-gray-800 mb-3\">Dados de Envio</h4>\n                    <div className=\"text-sm text-gray-700 space-y-1\">\n                      <p><strong>Nome:</strong> {shippingData.full_name}</p>\n                      <p><strong>Email:</strong> {shippingData.email}</p>\n                      <p><strong>Telefone:</strong> {shippingData.phone}</p>\n                      <p><strong>Morada:</strong> {shippingData.street}, {shippingData.city}, {shippingData.postal_code}, {shippingData.country}</p>\n                    </div>\n                  </div>\n\n                  {/* Op√ß√£o de guardar cart√£o */}\n                  {user && (\n                    <div className=\"mb-6\">\n                      <label className=\"flex items-center gap-3 cursor-pointer\">\n                        <input\n                          type=\"checkbox\"\n                          checked={saveCard}\n                          onChange={(e) => setSaveCard(e.target.checked)}\n                          className=\"w-5 h-5 text-sky-600 rounded cursor-pointer\"\n                        />\n                        <span className=\"text-sm text-gray-700\">Guardar informa√ß√µes de pagamento para compras futuras</span>\n                      </label>\n                    </div>\n                  )}\n\n                  {/* Bot√£o de Pagamento */}\n                  <button\n                    onClick={handlePayment}\n                    disabled={loading || !isFormValid()}\n                    className=\"w-full px-8 py-5 bg-gradient-to-r from-sky-600 to-blue-700 text-white rounded-xl hover:from-sky-700 hover:to-blue-800 transition-all duration-300 font-bold text-lg shadow-xl shadow-sky-300/50 whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none transform hover:scale-[1.02] hover:shadow-2xl hover:shadow-sky-400/60 active:scale-95\"\n                  >\n                    {loading ? (\n                      <span className=\"flex items-center justify-center gap-3\">\n                        <i className=\"ri-loader-4-line animate-spin text-2xl\"></i>\n                        A processar pagamento seguro...\n                      </span>\n                    ) : (\n                      <span className=\"flex items-center justify-center gap-3\">\n                        <i className=\"ri-lock-line text-xl\"></i>\n                        Pagar ‚Ç¨{finalTotal.toFixed(2)} com Seguran√ßa\n                      </span>\n                    )}\n                  </button>\n\n                  <p className=\"text-xs text-center text-gray-500 mt-4\">\n                    Ao clicar em \"Pagar\", ser√° redirecionado para uma p√°gina de pagamento segura\n                  </p>\n                </div>\n              )}\n            </div>\n\n            {/* Resumo do Pedido */}\n            <div className=\"lg:col-span-1\">\n              <div className=\"bg-white rounded-2xl p-6 shadow-sm border-2 border-sky-200 sticky top-24\">\n                <h3 className=\"text-xl font-bold text-gray-800 mb-4\">Resumo do Pedido</h3>\n                \n                <div className=\"space-y-3 mb-4 max-h-64 overflow-y-auto\">\n                  {items.map((item) => (\n                    <div key={item.id} className=\"flex gap-3\">\n                      <div className=\"w-16 h-16 bg-gray-100 rounded-lg overflow-hidden flex-shrink-0\">\n                        <img src={item.image} alt={item.name} className=\"w-full h-full object-cover\" />\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h4 className=\"font-medium text-gray-800 text-sm truncate\">{item.name}</h4>\n                        <p className=\"text-xs text-gray-600\">Qtd: {item.quantity}</p>\n                        <p className=\"text-sm font-semibold text-sky-600\">‚Ç¨{(item.price * item.quantity).toFixed(2)}</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                <div className=\"space-y-4 mb-6 border-t border-gray-200 pt-4\">\n                  <div className=\"flex justify-between text-base\">\n                    <span className=\"text-gray-700\">Subtotal</span>\n                    <span className=\"font-semibold text-gray-800\">\n                      ‚Ç¨{total.toFixed(2)}\n                    </span>\n                  </div>\n                  \n                  {/* üî• NOVO: Mostrar custo de envio din√¢mico por pa√≠s */}\n                  <div className=\"flex justify-between text-base\">\n                    <span className=\"text-gray-700\">\n                      Envio ({countryShippingRates.find(c => c.code === shippingData.country)?.name || shippingData.country})\n                    </span>\n                    <span className=\"font-semibold text-gray-800\">\n                      {actualShippingCost === 0 ? (\n                        <span className=\"text-green-600 font-bold\">Gr√°tis üéâ</span>\n                      ) : (\n                        `‚Ç¨${actualShippingCost.toFixed(2)}`\n                      )}\n                    </span>\n                  </div>\n                  \n                  {/* Aviso de envio gr√°tis */}\n                  {total < freeShippingThreshold && freeShippingThreshold > 0 && (\n                    <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\n                      <p className=\"text-xs text-yellow-700\">\n                        üí° Faltam <strong>‚Ç¨{(freeShippingThreshold - total).toFixed(2)}</strong> para envio gr√°tis em {countryShippingRates.find(c => c.code === shippingData.country)?.name || shippingData.country}!\n                      </p>\n                    </div>\n                  )}\n                  \n                  {/* IVA */}\n                  {vatEnabled && vatRate > 0 && (\n                    <div className=\"flex justify-between text-base\">\n                      <span className=\"text-gray-700\">\n                        IVA ({vatRate}%) - {shippingData.country}\n                      </span>\n                      <span className=\"font-semibold text-gray-800\">\n                        {vatIncluded ? (\n                          <span className=\"text-green-600 flex items-center gap-1\">\n                            <span className=\"text-gray-600\">‚Ç¨{(vatAmount + shippingVat).toFixed(2)}</span>\n                            <span className=\"text-xs\">(inclu√≠do)</span>\n                          </span>\n                        ) : (\n                          <span className=\"text-sky-600\">‚Ç¨{(vatAmount + shippingVat).toFixed(2)}</span>\n                        )}\n                      </span>\n                    </div>\n                  )}\n                  \n                  <div className=\"border-t border-gray-300 pt-4 flex justify-between items-center\">\n                    <span className=\"text-lg font-bold text-gray-800\">\n                      Total\n                    </span>\n                    <span className=\"text-3xl font-bold text-sky-600\">\n                      ‚Ç¨{finalTotal.toFixed(2)}\n                    </span>\n                  </div>\n                  \n                  {/* Texto legal sobre IVA */}\n                  {vatEnabled && (\n                    <div className=\"pt-2 border-t border-gray-200\">\n                      {vatIncluded ? (\n                        <p className=\"text-xs text-gray-500 text-center\">\n                          {vatSettings?.legalText || 'Os pre√ßos incluem IVA conforme a legisla√ß√£o da Uni√£o Europeia.'}\n                        </p>\n                      ) : (\n                        <p className=\"text-xs text-gray-500 text-center\">\n                          O IVA foi calculado conforme o pa√≠s de entrega selecionado ({shippingData.country}).\n                        </p>\n                      )}\n                      \n                      {/* Breakdown do IVA */}\n                      <div className=\"mt-3 p-3 bg-blue-50 rounded-lg\">\n                        <p className=\"text-xs text-blue-700 font-medium mb-2 text-center\">\n                          üìä Detalhes do IVA:\n                        </p>\n                        <div className=\"space-y-1 text-xs text-blue-600\">\n                          {vatIncluded ? (\n                            <>\n                              <div className=\"flex justify-between\">\n                                <span>Subtotal produtos:</span>\n                                <span className=\"font-semibold\">‚Ç¨{total.toFixed(2)}</span>\n                              </div>\n                              <div className=\"flex justify-between text-blue-500 text-[10px]\">\n                                <span className=\"pl-2\">‚Ä¢ Base (sem IVA):</span>\n                                <span>‚Ç¨{(total - vatAmount).toFixed(2)}</span>\n                              </div>\n                              <div className=\"flex justify-between text-blue-500 text-[10px]\">\n                                <span className=\"pl-2\">‚Ä¢ IVA ({vatRate}%):</span>\n                                <span>‚Ç¨{vatAmount.toFixed(2)}</span>\n                              </div>\n                              \n                              {actualShippingCost > 0 && (\n                                <>\n                                  <div className=\"flex justify-between mt-2\">\n                                    <span>Envio:</span>\n                                    <span className=\"font-semibold\">‚Ç¨{actualShippingCost.toFixed(2)}</span>\n                                  </div>\n                                  <div className=\"flex justify-between text-blue-500 text-[10px]\">\n                                    <span className=\"pl-2\">‚Ä¢ Base (sem IVA):</span>\n                                    <span>‚Ç¨{(actualShippingCost - shippingVat).toFixed(2)}</span>\n                                  </div>\n                                  <div className=\"flex justify-between text-blue-500 text-[10px]\">\n                                    <span className=\"pl-2\">‚Ä¢ IVA ({vatRate}%):</span>\n                                    <span>‚Ç¨{shippingVat.toFixed(2)}</span>\n                                  </div>\n                                </>\n                              )}\n                              \n                              <div className=\"flex justify-between border-t border-blue-200 pt-1 mt-2\">\n                                <span className=\"font-medium\">IVA total inclu√≠do:</span>\n                                <span className=\"font-bold text-green-600\">‚Ç¨{(vatAmount + shippingVat).toFixed(2)}</span>\n                              </div>\n                              <div className=\"flex justify-between border-t border-blue-200 pt-1\">\n                                <span className=\"font-medium\">Total a pagar:</span>\n                                <span className=\"font-bold\">‚Ç¨{finalTotal.toFixed(2)}</span>\n                              </div>\n                            </>\n                          ) : (\n                            <>\n                              <div className=\"flex justify-between\">\n                                <span>Subtotal (sem IVA):</span>\n                                <span className=\"font-semibold\">‚Ç¨{total.toFixed(2)}</span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span>IVA sobre produtos ({vatRate}%):</span>\n                                <span className=\"font-semibold text-sky-600\">+ ‚Ç¨{vatAmount.toFixed(2)}</span>\n                              </div>\n                              <div className=\"flex justify-between\">\n                                <span>Envio:</span>\n                                <span className=\"font-semibold\">\n                                  {actualShippingCost === 0 ? 'Gr√°tis' : `+ ‚Ç¨${actualShippingCost.toFixed(2)}`}\n                                </span>\n                              </div>\n                              {actualShippingCost > 0 && shippingVat > 0 && (\n                                <div className=\"flex justify-between\">\n                                  <span>IVA sobre envio ({vatRate}%):</span>\n                                  <span className=\"font-semibold text-sky-600\">+ ‚Ç¨{shippingVat.toFixed(2)}</span>\n                                </div>\n                              )}\n                              <div className=\"flex justify-between border-t border-blue-200 pt-1\">\n                                <span>Total a pagar:</span>\n                                <span className=\"font-bold\">‚Ç¨{finalTotal.toFixed(2)}</span>\n                              </div>\n                            </>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* Suporte ao Cliente */}\n                <div className=\"mt-6 p-4 bg-sky-50 rounded-xl border-2 border-sky-200\">\n                  <div className=\"flex items-start gap-3\">\n                    <i className=\"ri-customer-service-line text-2xl text-sky-600\"></i>\n                    <div>\n                      <h4 className=\"font-semibold text-gray-800 text-sm mb-1\">Precisa de Ajuda?</h4>\n                      <p className=\"text-xs text-gray-600 mb-2\">Estamos aqui para si!</p>\n                      <div className=\"text-xs text-gray-700 space-y-1\">\n                        <p>üë®‚Äçüíº <strong>Suporte:</strong> 8:30-18:00</p>\n                        <p>üìû <strong>Tel:</strong> +352 631 377 168</p>\n                        <p>üìß <strong>Email:</strong> contacto@marisol.com</p>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </main>\n\n      <Footer />\n    </div>\n  );\n}\n"],"names":["supabase","createClient","CheckoutPage","navigate","useNavigate","items","total","clearCart","useCart","user","useAuth","step","setStep","useState","loading","setLoading","errorMessage","setErrorMessage","saveCard","setSaveCard","shippingData","setShippingData","savedAddresses","setSavedAddresses","selectedAddressId","setSelectedAddressId","showAddressSelector","setShowAddressSelector","countryShippingRates","setCountryShippingRates","shippingCost","setShippingCost","freeShippingThreshold","setFreeShippingThreshold","vatSettings","setVatSettings","vatAmount","setVatAmount","vatEnabled","setVatEnabled","vatIncluded","setVatIncluded","vatRate","setVatRate","useEffect","loadSavedAddresses","loadCountryShippingRates","updateShippingCostForCountry","loadVatSettings","data","error","countryCode","rates","ratesToUse","countryConfig","c","settings","isIncluded","countryTax","t","rate","productVat","defaultAddress","addr","handleAddressSelect","address","prev","isFormValid","handleContinueToPayment","handlePayment","authToken","currentUrl","successUrl","cancelUrl","requestBody","item","headers","response","responseText","e","err","actualShippingCost","finalTotal","shippingVat","jsxs","jsx","Header","Fragment","Footer"],"mappings":"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"}